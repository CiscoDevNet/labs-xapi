# Step 5: Updating your Device's Configuration

The panel created in the previous steps of this lab looks pretty static for now.
Yet, under the cover, xAPI events do fire every time you interact with the 'Slider' widget: moving the slider to the left, to the right, pressing, releasing buttons...

> Bringing interactivity to an In-Room Controls panel happens by adding custom code logic that listens to the events fired by the various widgets that composes your panel.

Update your script with the [extra lines below](https://github.com/CiscoDevNet/labs-xapi/blob/master/code/collab-xapi-controls/step3/control.js), placed at the end of the `xapi.on('ready')` block:

```javascript
const jsxapi = require('jsxapi')
...

// CE maximum value for Ultrasound's MaxVolume
const MAX = 90 // for a DX, and 70 for a RoomKit

xapi.on('ready', () => {
    console.log("connexion successful")

    // Initialize Widgets with current volume
    xapi.config.get('Audio Ultrasound MaxVolume')
        .then(...)
        .catch(...)

    // Update configuration from UI actions
    xapi.event.on('UserInterface Extensions Widget Action', (event) => {
        if (event.WidgetId !== 'volume_slider') return
        if (event.Type !== 'changed') return

        // Update Ultrasound configuration
        const volume = Math.round(parseInt(event.Value) * MAX / 255)
        console.log(`updating Ultrasound configuration to: ${volume}`)
        xapi.config.set('Audio Ultrasound MaxVolume', volume)
    })
})
```

The `xapi.event.on('UserInterface Extensions Widget Action')` instruction registers your code to listen to events fired by the widgets of all custom In-Room Controls deployed on your device. 
The two next lines check for `event.WidgetId` and `event.Type` in order to filter out all events but the state `changed` event of the `volume_slider` widget.

Moreover, the instruction `Math.round(parseInt(event.Value) * MAX / 255)` transform once more the slider's current value (range 0-255) to an "Ultrasound MaxVolume" value suitable for your device's range.

Finally, the "Ultrasound MaxVolume" configuration setting of your device is updated thanks to the `xapi.config.set` instruction.

**Now, restart your script, and move your panel's slider around.**

![Move Slider](assets/images/step5-move-slider-around.png)


As you move the slider, youâ€™ll see events flying in the console:

```shell
$  node control.js
connexion successful
current volume is: 60
updating Ultrasound configuration to: 58
updating Ultrasound configuration to: 46
updating Ultrasound configuration to: 39
updating Ultrasound configuration to: 38
updating Ultrasound configuration to: 28
```

Reach to your device's Web UI, and check the value for "Ultrasound MaxVolume" is reflected among the Audio Configuration settings:

![Configuration Reflects Changes](assets/images/step5-configuration-reflects-changes.png)


Excellent! 
But as you noticed, the "Text" widget does not update... yet. 
We will fix that in the next step of the lab.
